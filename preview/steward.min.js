/* @triplett/steward v1.0.0 */
!function(){var a,t,u,f,l,b;function w(t,n){if(null==t)return{};var e,r=function(t,n){if(null==t)return{};var e,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)e=i[r],0<=n.indexOf(e)||(o[e]=t[e]);return o}(t,n);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(t),i=0;i<o.length;i++)e=o[i],0<=n.indexOf(e)||Object.prototype.propertyIsEnumerable.call(t,e)&&(r[e]=t[e]);return r}function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t){return function(t){if(Array.isArray(t))return r(t)}(t)||A(t)||$(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function O(t,n){return E(t)||function(t,n){var e=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=e){var r,o,i=[],c=!0,a=!1;try{for(e=e.call(t);!(c=(r=e.next()).done)&&(i.push(r.value),!n||i.length!==n);c=!0);}catch(t){a=!0,o=t}finally{try{c||null==e.return||e.return()}finally{if(a)throw o}}return i}}(t,n)||$(t,n)||x()}function x(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $(t,n){if(t){if("string"==typeof t)return r(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}function r(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function E(t){if(Array.isArray(t))return t}function I(t){for(var n=arguments.length,o=new Array(1<n?n-1:0),e=1;e<n;e++)o[e-1]=arguments[e];var r=this[""],i=O(P(t),2),c=i[0],i=i[1],c="".concat(r,"/").concat(c),a=u;return void 0!==i&&(r=!/^image\/(?!svg)/.test(T[i]),c+=".".concat(i),a=o.length?l:f,o.splice(1,o.length,r?"utf8":"")),new Promise(function(e,r){a.apply(void 0,[c].concat(o,[function(t,n){return t?r(t):e(n)}]))})}function o(n,t){var s=[];Array.isArray(t)&&(t=(r=E(e=t)||A(e)||$(e)||x())[0],s=(s=r.slice(1)).map(function(t){return t.replace(/^\/+/,"")}));var e=O(t.match(/^(.*?)(?:\/|\\)([^/\\#]+)#(.*?)$/),4),r=e[1],p=e[2],y=e[3];s.unshift(p);for(var e=require("./".concat(p)),d=new Set,o=arguments.length,i=new Array(2<o?o-2:0),c=2;c<o;c++)i[c-2]=arguments[c];var m=[[/^$/].concat(S(i.slice(0,2)))],e={"":r,_:y,$_:d,$:e,_$:p},v=I.bind(e),h=function(t){if("object"!==j(t))return"";var n=this[""],e=this.$_,r=this.$,o=this._,i=t[""],c=w(t,[""]);if("string"!=typeof i)return"";var a,t=O(i.match(/^(.*?)(?:#(.*?))?$/),3),i=t[1],i=void 0===i?"":i,t=t[2],t=void 0===t?"":t;try{i=i.replace(/^\/*/,"/"),a=i&&require("".concat(n).concat(i)),t&&e.add(i)}catch(t){}return[r({"":"div"},a&&r(b=b||function(t,n){return n=n||t.slice(0),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}}))}(["<"," "," />"]),a,c)),t&&[r({"":"script",type:"application/json"},JSON.stringify(c)),r({"":"script"},"(function(){","var s,p,c;","s=document.querySelectorAll('script');","s=s[s.length-1];","p=s.previousSibling;","c=p.previousSibling;","p=JSON.parse(p.innerHTML);","".concat(o,"({'':c},").concat(o,"(window.").concat(t,",p));"),"})();")].join("")].join("")}.bind(e),g=function n(e,t,r){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:200;if("string"!=typeof t){if(r===T.html)return void I.bind(this)("404.html").then(function(t){return n(e,t,r,404)});t=JSON.stringify(t),r=r||T.json}void 0===t&&(o=404,t="Not found",r=T.txt);var i=!/^image\/(?!svg)/.test(r);e.writeHead(o,{"Content-Length":Buffer.byteLength(t),"Content-Type":"".concat(r).concat(i?"; charset=utf-8":"")});e.end(t)}.bind(e);return a(function(t,n){var e=t.url,r=t.method;if("DELETE"!==r){var o,i,c,t="GET"===r?[]:[(o=t,new Promise(function(t){var n="";o.on("data",function(t){1e6<(n+=t).length&&o.connection.destroy()}),o.on("end",function(){return t(n)})}))],e=O(P.apply(void 0,[e].concat(t)),3),a=e[0],t=e[1],e=e[2];if(void 0!==t){if(a+=".".concat(t),i=T[t],s.includes(a))return v(a).then(function(t){return g(n,t,i)});var u=m.find(function(t){var n=O(t,3),t=n[0];return n[2]&&t.test(a)});if(!u)return g(n);var f=O(u,3),l=f[0],u=f[2]}else{f=m.find(function(t){return O(t,1)[0].test(a)});if(!f)return g(n,void 0,T.html);f=O(f,2);l=f[0],u=f[1]}l=(a.match(l)||[]).slice(1);try{c=u.apply(void 0,[e].concat(S(l),[v]))}catch(t){}Promise.resolve(c,v).catch(function(){}).then(function(t){if("function"!=typeof t)return t;var n;d.clear(),i=T.html;try{n=t(h)}catch(t){}return Promise.resolve(n).catch(function(){}).then(function(t){if("string"==typeof t)return i===T.html&&d.size?t.replace(/(\n\t*?)<\/head>/,function(t,n){return["".concat(n,'\t<script src="/').concat(p,'"><\/script>'),"".concat(n,"\t<script>window.").concat(y,"=window.stew<\/script>"),t].join("")}).replace(/(\n\t*?)<body>/,function(t,n){return"".concat(t).concat(S(d).map(function(t){return"".concat(n,'\t<script src="').concat(t,'"><\/script>')}).join(""))}):t})}).then(function(t){return g(n,t,i)})}}).listen(n,function(t){return console.log("server is listening on ".concat(n))}),function t(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return m.unshift(e),t}}function P(t){for(var n=O(t.match(/^\/*(.*?)?(?:\.([^/.?#]*))?\/*(?:\?(.*?))?$/),4),e=n[1],r=void 0===e?"":e,e=n[2],n=n[3],o=arguments.length,i=new Array(1<o?o-1:0),c=1;c<o;c++)i[c-1]=arguments[c];var a=i.length?{"":i.shift()}:{};if(n){var u,f=function(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=$(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){c=!0,o=t},f:function(){try{i||null==e.return||e.return()}finally{if(c)throw o}}}}(n.split("&"));try{for(f.s();!(u=f.n()).done;){var l=u.value,s=l.indexOf("=");s<1||(~s?a[l.slice(0,s)]=l.slice(s+1):a[l]=!0)}}catch(t){f.e(t)}finally{f.f()}}return[r,e,a]}"undefined"!=typeof module&&module.exports&&(a=(t=require("http")).createServer),"undefined"!=typeof module&&module.exports&&(u=(t=require("fs")).readdir,f=t.readFile,l=t.writeFile);var T={txt:"text/plain",html:"text/html",css:"text/css",js:"application/javascript",json:"application/json",bmp:"image/bmp",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",ico:"image/x-icon"};function n(t){for(var n=arguments.length,e=new Array(1<n?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];if("number"==typeof t)return o.apply(void 0,[t].concat(e))}"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!=typeof module&&module.exports?module.exports=n:"object"==typeof window&&window.document&&(window.steward=n)}();