/* @triplett/steward v1.0.0 */
!function(){var o,t,u,f,l,v;function h(t,n){if(null==t)return{};var e,r=function(t,n){if(null==t)return{};var e,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)e=i[r],0<=n.indexOf(e)||(o[e]=t[e]);return o}(t,n);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(t),i=0;i<o.length;i++)e=o[i],0<=n.indexOf(e)||Object.prototype.propertyIsEnumerable.call(t,e)&&(r[e]=t[e]);return r}function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t){return function(t){if(Array.isArray(t))return r(t)}(t)||i(t)||j(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function w(t,n){return a(t)||function(t,n){var e=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=e){var r,o,i=[],c=!0,a=!1;try{for(e=e.call(t);!(c=(r=e.next()).done)&&(i.push(r.value),!n||i.length!==n);c=!0);}catch(t){a=!0,o=t}finally{try{c||null==e.return||e.return()}finally{if(a)throw o}}return i}}(t,n)||j(t,n)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(t,n){if(t){if("string"==typeof t)return r(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}function r(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function a(t){if(Array.isArray(t))return t}function S(t){for(var n=arguments.length,o=new Array(1<n?n-1:0),e=1;e<n;e++)o[e-1]=arguments[e];var r=this[""],i=w(A(t),2),c=i[0],i=i[1],c="".concat(r,"/").concat(c),a=u;return void 0!==i&&(r=!/^image\/(?!svg)/.test(O[i]),c+=".".concat(i),a=o.length?l:f,o.splice(1,o.length,r?"utf8":"")),new Promise(function(e,r){a.apply(void 0,[c].concat(o,[function(t,n){return t?r(t):e(n)}]))})}function s(n,t,e){var u=[];Array.isArray(t)&&(t=(r=a(r=t)||i(r)||j(r)||c())[0],u=(u=r.slice(1)).map(function(t){return t.replace(/^\/+/,"")}));var r=w(t.match(/^(.*?)(?:\/|\\)([^/\\#]+)#(.*?)$/),4),t=r[1],f=r[2],l=r[3];u.unshift(f,"favicon.ico");var r=require("./".concat(f)),s=new Set,p=[];"function"==typeof e&&p.push([/^$/,e]);var r={"":t,_:l,$_:s,$:r,_$:f},y=S.bind(r),d=function(t){if("object"!==b(t))return"";var n=this[""],e=this.$_,r=this.$,o=this._,i=t[""],c=h(t,[""]);if("string"!=typeof i)return"";var a,t=w(i.match(/^(.*?)(?:#(.*?))?$/),3),i=t[1],i=void 0===i?"":i,t=t[2],t=void 0===t?"":t;try{i=i.replace(/^\/*/,"/"),a=i&&require("".concat(n).concat(i)),t&&e.add(i)}catch(t){}return[r({"":"div"},a&&r(v=v||function(t,n){return n=n||t.slice(0),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}}))}(["<"," "," />"]),a,c)),t&&[r({"":"script",type:"application/json"},JSON.stringify(c)),r({"":"script"},"(function(){","var s,p,c;","s=document.querySelectorAll('script');","s=s[s.length-1];","p=s.previousSibling;","c=p.previousSibling;","p=JSON.parse(p.innerHTML);","".concat(o,"({'':c},").concat(o,"(window.").concat(t,",p));"),"})();")].join("")].join("")}.bind(r),m=function n(e,t,r){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:200;if(t instanceof Buffer||"string"==typeof t)r=r||O.html;else{if(!r)return void S.bind(this)("404.html").then(function(t){return n(e,t,r,404)});t=void 0===t?(o=404,"Not found"):JSON.stringify(t)}var i=!/^image\/(?!svg)/.test(r);e.writeHead(o,{"Content-Length":Buffer.byteLength(t),"Content-Type":"".concat(r).concat(i?"; charset=utf-8":"")});e.end(t)}.bind(r);return o(function(t,n){var e=t.url,r=t.method;if("DELETE"!==r){var o,i,c,r="GET"===r?[]:[(o=t,new Promise(function(t){var n="";o.on("data",function(t){1e6<(n+=t).length&&o.connection.destroy()}),o.on("end",function(){return t(n)})}))],t=w(A.apply(void 0,[e].concat(r)),3),a=t[0],e=t[1],r=t[2];if(void 0!==e&&(a+=".".concat(e),i=O[e],u.includes(a)))y(a).catch(function(){}).then(function(t){return m(n,t,i)});else{t=p.find(function(t){return w(t,1)[0].test(a)});if(!t)return m(n,void 0,i);e=w(t,2),t=e[0],e=e[1],t=(a.match(t)||[]).slice(1);try{c=e.apply(void 0,[r].concat(g(t),[y]))}catch(t){}Promise.resolve(c,y).catch(function(){}).then(function(t){if("function"!=typeof t)return i=i||O.json,t;if(!i){var n;s.clear();try{n=t(d)}catch(t){}return Promise.resolve(n).catch(function(){}).then(function(t){if("string"==typeof t)return s.size?t.replace(/(\n\t*?)<\/head>/,function(t,n){return["".concat(n,'\t<script src="/').concat(f,'"><\/script>'),"".concat(n,"\t<script>window.").concat(l,"=window.stew<\/script>"),t].join("")}).replace(/(\n\t*?)<body>/,function(t,n){return"".concat(t).concat(g(s).map(function(t){return"".concat(n,'\t<script src="').concat(t,'"><\/script>')}).join(""))}):t})}}).then(function(t){return m(n,t,i)})}}}).listen(n,function(t){return console.log("server is listening on ".concat(n))}),function t(n,e){return n instanceof RegExp&&"function"==typeof e&&p.unshift([n,e]),t}}function A(t){for(var n=w(t.match(/^\/*(.*?)?(?:\.([^/.?#]*))?\/*(?:\?(.*?))?$/),4),e=n[1],r=void 0===e?"":e,e=n[2],n=n[3],o=arguments.length,i=new Array(1<o?o-1:0),c=1;c<o;c++)i[c-1]=arguments[c];var a=i.length?{"":i.shift()}:{};if(n){var u,f=function(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=j(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){c=!0,o=t},f:function(){try{i||null==e.return||e.return()}finally{if(c)throw o}}}}(n.split("&"));try{for(f.s();!(u=f.n()).done;){var l=u.value,s=l.indexOf("=");s<1||(~s?a[l.slice(0,s)]=l.slice(s+1):a[l]=!0)}}catch(t){f.e(t)}finally{f.f()}}return[r,e,a]}"undefined"!=typeof module&&module.exports&&(o=(t=require("http")).createServer),"undefined"!=typeof module&&module.exports&&(u=(t=require("fs")).readdir,f=t.readFile,l=t.writeFile);var O={txt:"text/plain",html:"text/html",css:"text/css",js:"application/javascript",json:"application/json",bmp:"image/bmp",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",ico:"image/x-icon"};function n(t){for(var n=arguments.length,e=new Array(1<n?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];if("number"==typeof t)return s.apply(void 0,[t].concat(e))}"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!=typeof module&&module.exports?module.exports=n:"object"==typeof window&&window.document&&(window.steward=n)}();